var data = [
  {
    language: "Afrikaans",
    x: -47.9,
    y: 93.2,
    geo: 6,
    family: 5,
    happiness: 15.9,
    countries: "South Africa | Namibia",
    lang_written: "Afrikaans",
    unique_word_per_lang: "Hope",
    unique_lang_per_word: "Life",
    main_country: "South-Africa",
    family_name: "Indo-European, Germanic, West",
    speakers: 7200000
  },
  {
    language: "Albanian",
    x: 11,
    y: 58.4,
    geo: 5,
    family: 8,
    happiness: 36.8,
    countries: "Albania | Kosovo | Macedonia | Serbia",
    lang_written: "shqip",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Albania",
    family_name: "Indo-European",
    speakers: 5400000
  },
  {
    language: "Amharic",
    x: 68.4,
    y: -123,
    geo: 6,
    family: 12,
    happiness: 26.7,
    countries: "Ethiopia",
    lang_written: "ኣማርኛ",
    unique_word_per_lang: "Power",
    unique_lang_per_word:
      "Hostility | Aversion | Alienation | Power | Impulsiveness",
    main_country: "Ethiopia",
    family_name: "Afro-Asiatic, Semitic",
    speakers: 22000000
  },
  {
    language: "Arabic",
    x: 90.5,
    y: 39.5,
    geo: 8,
    family: 12,
    happiness: 23.8,
    countries: "Egypt | Isarel | Lebanon | more than 30 other countries...",
    lang_written: "العربية",
    unique_word_per_lang: "Blessed",
    unique_lang_per_word: "Fulfillment | Blessed",
    main_country: "Egypt",
    family_name: "Afro-Asiatic, Semitic",
    speakers: 280000000
  },
  {
    language: "Armenian",
    x: 52.2,
    y: -43.8,
    geo: 7,
    family: 8,
    happiness: 25.7,
    countries: "Armenia | Azerbaijan | Georgia | Iraq | Lebanon | Syria",
    lang_written: "Հայերեն",
    unique_word_per_lang: "Calm",
    unique_lang_per_word: "Calm | Forgiveness | Creativity",
    main_country: "Aremina",
    family_name: "Indo-European",
    speakers: 6700000
  },
  {
    language: "Azeri",
    x: 43,
    y: -128,
    geo: 7,
    family: 9,
    happiness: 0,
    countries: "Azerbaijan | Turkey",
    lang_written: "Азәрбајҹан дили",
    unique_word_per_lang: "Acceptance",
    unique_lang_per_word: "Acceptance",
    main_country: "Azerbaijan",
    family_name: "Turkic",
    speakers: 500000
  },
  {
    language: "Bengali",
    x: -45.4,
    y: -198,
    geo: 9,
    family: 11,
    happiness: 38.4,
    countries: "Bangladesh | India",
    lang_written: "বাংলা",
    unique_word_per_lang: "Worry",
    unique_lang_per_word: "Jealousy | Loyalty | Worry",
    main_country: "Bangladesh",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 201000000
  },
  {
    language: "Catalan",
    x: 32.6,
    y: 97.9,
    geo: 2,
    family: 7,
    happiness: 0,
    countries: "Andorra | Spain | France",
    lang_written: "català",
    unique_word_per_lang: "Mercy",
    unique_lang_per_word: "Mercy",
    main_country: "Andorra",
    family_name: "Indo-European, Romance, Western",
    speakers: 4000000
  },
  {
    language: "Croatian",
    x: -16.2,
    y: 46.3,
    geo: 5,
    family: 1,
    happiness: 30.2,
    countries: "Croatia | Austria | Bosnia and Herzegovina | Serbia | Slovenia",
    lang_written: "Hrvatski",
    unique_word_per_lang: "Affection",
    unique_lang_per_word: "Affection",
    main_country: "Croatia",
    family_name: "Indo-European, Slavic",
    speakers: 5600000
  },
  {
    language: "Czech",
    x: -8.18,
    y: 13,
    geo: 5,
    family: 1,
    happiness: 27.3,
    countries: "Czech Republic | Croatia",
    lang_written: "čeština",
    unique_word_per_lang: "Joy",
    unique_lang_per_word: "",
    main_country: "Czech-Republic",
    family_name: "Indo-European, Slavic",
    speakers: 10600000
  },
  {
    language: "Danish",
    x: -96.4,
    y: 35.9,
    geo: 3,
    family: 4,
    happiness: 32.7,
    countries: "Denmark | Faroe Islands | Greenland | Germany",
    lang_written: "dansk",
    unique_word_per_lang: "Hope",
    unique_lang_per_word: "Hope",
    main_country: "Denmark",
    family_name: "Indo-European, Germanic, North",
    speakers: 5500000
  },
  {
    language: "Dutch",
    x: -61.4,
    y: 111,
    geo: 2,
    family: 5,
    happiness: 35.3,
    countries: "Netherlands | Belgium | Indonesia | Suriname",
    lang_written: "Nederlands",
    unique_word_per_lang: "Success",
    unique_lang_per_word: "Pressure",
    main_country: "Netherlands",
    family_name: "Indo-European, Germanic, West",
    speakers: 22000000
  },
  {
    language: "English",
    x: -69.1,
    y: 26.8,
    geo: 3,
    family: 5,
    happiness: 25.18,
    countries:
      "USA | Australia | United Kingdom | more than 80 other countries...",
    lang_written: "English",
    unique_word_per_lang: "Love",
    unique_lang_per_word: "Love",
    main_country: "USA - England - Australia",
    family_name: "Indo-European, Germanic, West",
    speakers: 335000000
  },
  {
    language: "Estonian",
    x: 7.72,
    y: 40.9,
    geo: 4,
    family: 10,
    happiness: 17.9,
    countries: "Estonia",
    lang_written: "eesti keel",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Estonia",
    family_name: "Uralic, Finno-Ugric",
    speakers: 1165400
  },
  {
    language: "Finnish",
    x: -62.5,
    y: -119,
    geo: 3,
    family: 10,
    happiness: 31.3,
    countries: "Finland | Norway | Sweden",
    lang_written: "suomi",
    unique_word_per_lang: "Habit",
    unique_lang_per_word: "Frustration",
    main_country: "Finland",
    family_name: "Uralic, Finno-Ugric",
    speakers: 5400000
  },
  {
    language: "French",
    x: 36.9,
    y: 171,
    geo: 2,
    family: 7,
    happiness: 30.4,
    countries: "France | Canada | Morocco | more than 40 other countries...",
    lang_written: "français",
    unique_word_per_lang: "Evil",
    unique_lang_per_word: "",
    main_country: "France",
    family_name: "Indo-European, Romance, Western",
    speakers: 75900000
  },
  {
    language: "Georgian",
    x: 19.6,
    y: -115,
    geo: 7,
    family: 3,
    happiness: 31.1,
    countries: "Georgia",
    lang_written: "ქართული",
    unique_word_per_lang: "Desire",
    unique_lang_per_word: "Desire",
    main_country: "Georgia",
    family_name: "Kartvelian",
    speakers: 3700000
  },
  {
    language: "Greek",
    x: 111,
    y: -131,
    geo: 5,
    family: 8,
    happiness: 23.6,
    countries: "Greece | Albania | Cyprus",
    lang_written: "ελληνικά",
    unique_word_per_lang: "Joy",
    unique_lang_per_word: "Flamboyance | Destruction",
    main_country: "Greece",
    family_name: "Indo-European",
    speakers: 11000000
  },
  {
    language: "Hebrew",
    x: -1.01,
    y: 97.9,
    geo: 8,
    family: 12,
    happiness: 28.8,
    countries: "Israel",
    lang_written: "עברית",
    unique_word_per_lang: "Friendship",
    unique_lang_per_word: "Friendship",
    main_country: "Israel",
    family_name: "Afro-Asiatic, Semitic",
    speakers: 5000000
  },
  {
    language: "Hindi",
    x: -24.6,
    y: -192,
    geo: 9,
    family: 11,
    happiness: 29.2,
    countries: "India | Guyana | Trinidad and Tobago | United Arab Emirates",
    lang_written: "हिन्दी",
    unique_word_per_lang: "Secured",
    unique_lang_per_word:
      "Insult | Desperation | Fear | Empathy | Anxiety | Distress | Secured",
    main_country: "India",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 295000000
  },
  {
    language: "Hungarian",
    x: -47.3,
    y: -58.7,
    geo: 5,
    family: 10,
    happiness: 26.4,
    countries:
      "Hungary | Austria | Croatia | Romania | Serbia | Slovakia | Ukraine",
    lang_written: "magyar",
    unique_word_per_lang: "Sorry",
    unique_lang_per_word: "",
    main_country: "Hungary",
    family_name: "Uralic, Finno-Ugric",
    speakers: 13000000
  },
  {
    language: "Icelandic",
    x: -54.5,
    y: 6.71,
    geo: 3,
    family: 4,
    happiness: 31.1,
    countries: "Iceland",
    lang_written: "Íslenska",
    unique_word_per_lang: "Fun",
    unique_lang_per_word: "Fun",
    main_country: "Iceland",
    family_name: "Indo-European, Germanic, North",
    speakers: 330000
  },
  {
    language: "Indonesian",
    x: 23.8,
    y: -52,
    geo: 10,
    family: 14,
    happiness: 35.7,
    countries: "Indonesia",
    lang_written: "Bahasa Indonesia",
    unique_word_per_lang: "Love",
    unique_lang_per_word: "",
    main_country: "Indonesia",
    family_name: "Austronesian, Malayo-Polynesian",
    speakers: 43000000
  },
  {
    language: "Italian",
    x: 104,
    y: 90.3,
    geo: 2,
    family: 7,
    happiness: 28.1,
    countries: "Italy | Argentina | Croatia | Libya | Somalia | Switzerland",
    lang_written: "italiano",
    unique_word_per_lang: "Hurt",
    unique_lang_per_word: "Hurt",
    main_country: "Italy",
    family_name: "Indo-European, Romance",
    speakers: 65000000
  },
  {
    language: "Japanese",
    x: 28.6,
    y: -72.6,
    geo: 10,
    family: 15,
    happiness: 28.3,
    countries: "Japan | Marshall Islands | Palau",
    lang_written: "日本語",
    unique_word_per_lang: "Power",
    unique_lang_per_word: "Satisfaction | Tiredness",
    main_country: "Japan",
    family_name: "Japonic",
    speakers: 125000000
  },
  {
    language: "Kazakh",
    x: -4.42,
    y: -116,
    geo: 7,
    family: 9,
    happiness: 19.1,
    countries: "Kazakhstan",
    lang_written: "Қазақ тілі",
    unique_word_per_lang: "Soul",
    unique_lang_per_word: "",
    main_country: "Kazakhstan",
    family_name: "Turkic",
    speakers: 1000000
  },
  {
    language: "Khmer",
    x: 56,
    y: -159,
    geo: 9,
    family: 17,
    happiness: 25.6,
    countries: "Cambodia | Vietnam",
    lang_written: "ភាសាខ្មែរ",
    unique_word_per_lang: "Emotion",
    unique_lang_per_word: "Emotion | Nervousness | Activism",
    main_country: "Cambodia",
    family_name: "Austroasiatic",
    speakers: 16000000
  },
  {
    language: "Korean",
    x: -7.16,
    y: -13.1,
    geo: 10,
    family: 16,
    happiness: 24.8,
    countries: "South Korea | North Korea",
    lang_written: "한국어",
    unique_word_per_lang: "Dream",
    unique_lang_per_word:
      "Suicide | Laughter | Emptiness | Exhaustion | Sorry | Dream",
    main_country: "South-Korea",
    family_name: "Koreanic",
    speakers: 77200000
  },
  {
    language: "Latvian",
    x: 72.5,
    y: -12.3,
    geo: 4,
    family: 13,
    happiness: 17.1,
    countries: "Latvia",
    lang_written: "latviešu valoda",
    unique_word_per_lang: "Pleasure",
    unique_lang_per_word:
      "Pleasure | Joy | Astonishment | Laziness | Comradeship",
    main_country: "Latvia",
    family_name: "Indo-European, Baltic",
    speakers: 1750000
  },
  {
    language: "Lithuanian",
    x: 57,
    y: -24.7,
    geo: 4,
    family: 13,
    happiness: 21,
    countries: "Lithuania | Latvia",
    lang_written: "lietuvių kalba",
    unique_word_per_lang: "hope",
    unique_lang_per_word: "",
    main_country: "Lithuania",
    family_name: "Indo-European, Baltic",
    speakers: 3000000
  },
  {
    language: "Macedonian",
    x: 40.4,
    y: 12.4,
    geo: 5,
    family: 1,
    happiness: 23.4,
    countries: "Macedonia",
    lang_written: "македонски",
    unique_word_per_lang: "Kindness",
    unique_lang_per_word: "Kindness",
    main_country: "Macedonia",
    family_name: "Indo-European, Slavic",
    speakers: 1400000
  },
  {
    language: "Malaysian",
    x: -8.38,
    y: -59.8,
    geo: 10,
    family: 14,
    happiness: 30.3,
    countries: "Malaysia | Brunei | Singapore",
    lang_written: "Melayu",
    unique_word_per_lang: "Love",
    unique_lang_per_word:
      "Shame | Dismay | Passion | Optimism | Enthusiasm | Shyness",
    main_country: "Malaysia",
    family_name: "Austronesian, Malayo-Polynesian",
    speakers: 20000000
  },
  {
    language: "Nepali",
    x: -3.08,
    y: -189,
    geo: 9,
    family: 11,
    happiness: 30.5,
    countries: "Nepal",
    lang_written: "नेपाली",
    unique_word_per_lang: "Secured",
    unique_lang_per_word: "Integrity",
    main_country: "Nepal",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 20000000
  },
  {
    language: "Norwegian",
    x: -108,
    y: 55.9,
    geo: 3,
    family: 4,
    happiness: 36.8,
    countries: "Norway",
    lang_written: "norsk",
    unique_word_per_lang: "Faith",
    unique_lang_per_word: "Faith",
    main_country: "Norway",
    family_name: "Indo-European, Germanic, North",
    speakers: 4700000
  },
  {
    language: "Persian",
    x: 88.5,
    y: -140,
    geo: 7,
    family: 11,
    happiness: 24,
    countries: "Iran | Afghanistan | United Arab Emirates",
    lang_written: "فارسى",
    unique_word_per_lang: "Activism",
    unique_lang_per_word: "Melancholy",
    main_country: "Iran",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 55000000
  },
  {
    language: "Polish",
    x: 46.4,
    y: -9.06,
    geo: 4,
    family: 1,
    happiness: 27.5,
    countries: "Poland | Lithuania | Ukraine",
    lang_written: "polski",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Poland",
    family_name: "Indo-European, Slavic",
    speakers: 38500000
  },
  {
    language: "Portuguese_Brazil",
    x: 42.3,
    y: 131,
    geo: 1,
    family: 7,
    happiness: 34.3,
    countries: "Brazil | Portugal | more than 15 other countries...",
    lang_written: "português",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Brazil",
    family_name: "Indo-European, Romance, West",
    speakers: 200000000
  },
  {
    language: "Portuguese_Europe",
    x: 36,
    y: 145,
    geo: 2,
    family: 7,
    happiness: 24.8,
    countries: "Portugal | Brazil | more than 15 other countries...",
    lang_written: "português",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Portugal",
    family_name: "Indo-European, Romance, West",
    speakers: 10000000
  },
  {
    language: "Romanian",
    x: 46.5,
    y: 192,
    geo: 5,
    family: 7,
    happiness: 28.8,
    countries: "Romania | Moldova | Serbia | Ukraine",
    lang_written: "român",
    unique_word_per_lang: "Evil",
    unique_lang_per_word: "Evil | Soul | Trust | Success | Longing | Madness",
    main_country: "Romania",
    family_name: "Indo-European, Romance, Western",
    speakers: 24000000
  },
  {
    language: "Russian",
    x: 65.8,
    y: 132,
    geo: 4,
    family: 1,
    happiness: 18.7,
    countries: "Russia | Ukraine | more than 20 other countires...",
    lang_written: "Русский язык",
    unique_word_per_lang: "Love",
    unique_lang_per_word: "",
    main_country: "Russia",
    family_name: "Indo-European, Slavic",
    speakers: 166000000
  },
  {
    language: "Sinhala",
    x: 76.2,
    y: -75,
    geo: 9,
    family: 11,
    happiness: 33.8,
    countries: "Sri Lanka",
    lang_written: "සිංහල",
    unique_word_per_lang: "Power",
    unique_lang_per_word: "",
    main_country: "Sri-Lanka",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 14000000
  },
  {
    language: "Slovak",
    x: 15.3,
    y: 79,
    geo: 5,
    family: 1,
    happiness: 28.2,
    countries: "Slovakia | Croatia | Serbia",
    lang_written: "slovenčina",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Slovakia",
    family_name: "Indo-European, Slavic",
    speakers: 5200000
  },
  {
    language: "Slovenian",
    x: -47.9,
    y: 72,
    geo: 5,
    family: 1,
    happiness: 24.6,
    countries: "Slovenia",
    lang_written: "slovenščina",
    unique_word_per_lang: "Pride",
    unique_lang_per_word: "",
    main_country: "Slovenia",
    family_name: "Indo-European, Slavic",
    speakers: 2100000
  },
  {
    language: "Spanish_South_America",
    x: -18,
    y: 160,
    geo: 1,
    family: 7,
    happiness: 35.2,
    countries: "Argentina | Spain | more than 60 other countries...",
    lang_written: "español",
    unique_word_per_lang: "Evil",
    unique_lang_per_word: "",
    main_country: "Argentina",
    family_name: "Indo-European, Romance, West",
    speakers: 418000000
  },
  {
    language: "Spanish_Spain",
    x: -14.3,
    y: 174,
    geo: 2,
    family: 7,
    happiness: 36,
    countries: "Spain | Argentina | more than 60 other countries...",
    lang_written: "español",
    unique_word_per_lang: "Evil",
    unique_lang_per_word: "",
    main_country: "Spain",
    family_name: "Indo-European, Romance, West",
    speakers: 38000000
  },
  {
    language: "Swahili",
    x: 96.1,
    y: -164,
    geo: 6,
    family: 0,
    happiness: 22.2,
    countries: "Burundi | Comoros | Kenya | Rwanda | Tanzania | Uganda",
    lang_written: "Kiswahili",
    unique_word_per_lang: "Fairness",
    unique_lang_per_word:
      "Fairness | Ambition | Praise | Pessimism | Ethics | Panic | Failure",
    main_country: "Africa",
    family_name: "Niger–Congo",
    speakers: 12000000
  },
  {
    language: "Swedish",
    x: -112,
    y: 18.3,
    geo: 3,
    family: 4,
    happiness: 28,
    countries: "Sweden | Finland",
    lang_written: "svenska",
    unique_word_per_lang: "Hope",
    unique_lang_per_word: "",
    main_country: "Sweeden",
    family_name: "Indo-European, Germanic, North",
    speakers: 9100000
  },
  {
    language: "Tagalog",
    x: 40,
    y: 64,
    geo: 10,
    family: 14,
    happiness: 35,
    countries: "Philippines",
    lang_written: "Tagalog",
    unique_word_per_lang: "Fun",
    unique_lang_per_word: "Wrath",
    main_country: "Philippines",
    family_name: "Austronesian, Malayo-Polynesian",
    speakers: 28000000
  },
  {
    language: "Turkish",
    x: -29.6,
    y: -123.5,
    geo: 7,
    family: 9,
    happiness: 26.4,
    countries: "Turkey | Romania | Cyprus | Iran | Kosovo | Macedonia | Iraq",
    lang_written: "Türkçe",
    unique_word_per_lang: "Acceptance",
    unique_lang_per_word: "Hate | Terror | Nerve | Curiosity",
    main_country: "Turkey",
    family_name: "Turkic",
    speakers: 12000000
  },
  {
    language: "Ukrainian",
    x: 69.1,
    y: 40,
    geo: 4,
    family: 1,
    happiness: 26.4,
    countries: "Ukraine | Slovakia | Croatia | Poland",
    lang_written: "Українська",
    unique_word_per_lang: "Life",
    unique_lang_per_word: "",
    main_country: "Ukraine",
    family_name: "Indo-European, Slavic",
    speakers: 32600000
  },
  {
    language: "Urdu",
    x: 126,
    y: 84.5,
    geo: 9,
    family: 11,
    happiness: 31.5,
    countries:
      "Pakistan | Bahrain | Guyana | India | Oman | United Arab Emirates",
    lang_written: "اردو",
    unique_word_per_lang: "Hurt",
    unique_lang_per_word: "Cruelty | Contempt",
    main_country: "Pakistan",
    family_name: "Indo-European, Indo-Iranian",
    speakers: 81000000
  },
  {
    language: "Uzbek",
    x: 29.1,
    y: -176,
    geo: 7,
    family: 9,
    happiness: 29.1,
    countries: "Uzbekistan | Turkmenistan",
    lang_written: "ўзбек тили",
    unique_word_per_lang: "Secured",
    unique_lang_per_word: "",
    main_country: "Uzbekistan",
    family_name: "Turkic",
    speakers: 32000000
  },
  {
    language: "Welsh",
    x: 86,
    y: -40.3,
    geo: 3,
    family: 6,
    happiness: 0,
    countries: "Wales | United Kingdom",
    lang_written: "Cymraeg",
    unique_word_per_lang: "Habit",
    unique_lang_per_word:
      "Disgust | Habit | Disappointment | Encouragement | Greed | Arrogance",
    main_country: "Wales",
    family_name: "Indo-European, Celtic",
    speakers: 540000
  }
];

var linesArr = [65, 165, 265, 365, 465, 565, 665, 765];

var cur_view = "flag";
var cur_lang = data.findIndex(d => d.language == "English");
var hidePoints = true;
var index = 0;

widthInfo = 330;
var marginMap = { top: 125, right: 55 + widthInfo + 30, bottom: 120, left: 20 };
var marginInfo = { top: 125, right: 20, bottom: 40, left: 20 };

var xScale = d3
  .scaleLinear()
  .domain([d3.min(data, d => d.x), d3.max(data, d => d.x)]);
var yScale = d3
  .scaleLinear()
  .domain([d3.min(data, d => d.y), d3.max(data, d => d.y)]);
var happyScale = d3
  .scaleLinear()
  .domain([d3.min(data, d => d.happiness), d3.max(data, d => d.happiness)]);
happyScale.range([0, 1]);
updateWindowSize();

/** Initializing Main Divs */

var bodySelect = d3.select("body").attr("id", "cont");
var fixedSizeDiv = bodySelect.append("div").attr("class", "fixedSizeDiv");

var boxesContainer = fixedSizeDiv
  .append("div")
  .attr("id", "diva")
  .style("display", "flex")
  .style("justify-content", "center");

var svgContainer = boxesContainer
  .append("svg")
  .attr("width", widthMap)
  .attr("height", heightMap)
  .attr("class", "svgContainer");

/** Initializing Opening Screen */

var opening = bodySelect.append("div").attr("id", "overlayDiv");
opening.append("div").attr("class", "imgOpening");
var textHolder = opening.append("div").attr("class", "textsHolder");
textHolder
  .append("div")
  .attr("class", "textOpening")
  .text("EMOTIONAL WORLD");

textHolder
  .append("div")
  .attr("class", "secondTextOpening")
  .text(
    "enter the map & start investigating the world from another perspective"
  );

textHolder
  .append("button")
  .attr("class", "enterButtonDesign")
  .attr("id", "enterButton")
  .on("click", openMap)
  .text("ENTER");

/** Initializing ToolBar */

var toolBar = fixedSizeDiv.append("nav").attr("id", "toolBar");

toolBar.append("a").attr("class", "Logo buttonDesign");

toolBar
  .append("button")
  .attr("class", "buttonDesign active")
  .attr("id", "flagButton")
  .on("click", _ => {
    onButton("flag");
  });

document.getElementById("flagButton").innerHTML =
  "<i id='flagIcon' class='fa fa-flag fa-gradient active'></i>    Flags";

toolBar
  .append("button")
  .attr("class", " buttonDesign")
  .attr("id", "geoButton")
  .on("click", _ => {
    onButton("geo");
  });

document.getElementById("geoButton").innerHTML =
  "<i id='geoIcon' class='fa fa-globe fa-gradient'></i>    Geographic Locations";

toolBar
  .append("button")
  .attr("class", " buttonDesign")
  .attr("id", "familyButton")
  .on("click", _ => {
    onButton("family");
  });

document.getElementById("familyButton").innerHTML =
  "<i id='familyIcon' class='fa fa-tree fa-gradient'></i>    Language Families";

toolBar
  .append("button")
  .attr("class", " buttonDesign")
  .attr("id", "happinessButton")
  .on("click", _ => {
    onButton("happiness");
  });

document.getElementById("happinessButton").innerHTML =
  "<i id='happinessIcon' class='fa fa-thumbs-up fa-gradient'></i>    Happy Planet Index";

/** Initializing Info Frame */

var infoContainer = boxesContainer
  .append("svg")
  .attr("class", "svgInfo")
  .attr("id", "info")
  .style("width", widthInfo)
  .style("height", heightMap);

var infoHeadline = infoContainer
  .append("text")
  .attr("class", "infoHeadline")
  .attr("x", widthInfo / 10)
  .attr("y", "80px")
  .attr("text-anchor", "left");

infoContainer
  .append("line")
  .attr("x1", widthInfo / 10)
  .attr("x2", widthInfo - 30)
  .attr("y1", "100px")
  .attr("y2", "100px")
  .attr("stroke-width", "0.06em")
  .attr("stroke", "white")
  .attr("stroke-linejoin", "round");

var infoLanguageName = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("text-anchor", "end")

  .attr("x", widthInfo - 30)
  .attr("y", "125px")
  .attr("margin-right", "10px")

  .text("English");

uniqueX = widthInfo / 4;
uniqueY = 180;
infoContainer
  .append("text")
  .attr("class", "mostUsedWordHeadline")
  .attr("x", uniqueX)
  .attr("y", uniqueY)
  .attr("text-anchor", "middle")
  .text("Unique Word: ");

var mostUsedWords = infoContainer
  .append("text")
  .attr("class", "mostUsedWord")
  .attr("x", uniqueX)
  .attr("y", uniqueY + 35)
  .attr("text-anchor", "middle");

speakersX = widthInfo / 1.4;
speakersY = 180;
infoContainer
  .append("text")
  .attr("class", "mostUsedWordHeadline")
  .attr("x", speakersX)
  .attr("y", speakersY)
  .attr("text-anchor", "middle")
  .text("Native Speakers: ");

var numSpeakers = infoContainer
  .append("text")
  .attr("class", "mostUsedWord")
  .attr("x", speakersX)
  .attr("y", speakersY + 35)
  .attr("text-anchor", "middle");

infoContainer
  .append("line")
  .attr("x1", widthInfo / 2 - 13)
  .attr("x2", widthInfo / 2 - 13)
  .attr("y1", uniqueY - 15)
  .attr("y2", uniqueY + 43)
  .attr("stroke-width", "0.04em")
  .attr("stroke", "rgb(255, 255, 255)")
  .attr("stroke-linejoin", "round")
  .attr("stroke-style", "dashed");

mostUsedX = widthInfo / 2;
mostUsedY = 280;
infoContainer
  .append("text")
  .attr("class", "mostUsedWordHeadline")
  .attr("x", mostUsedX)
  .attr("y", mostUsedY)
  .attr("text-anchor", "middle")
  .text("Words most used by this language:");

var wordsUsedByLang = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("x", mostUsedX)
  .attr("y", mostUsedY + 40)
  .attr("text-anchor", "middle");

infoContainer
  .append("line")
  .attr("x1", widthInfo / 7)
  .attr("x2", widthInfo - 48)
  .attr("y1", mostUsedY + 6)
  .attr("y2", mostUsedY + 6)
  .attr("stroke-width", "0.04em")
  .attr("stroke", "rgb(155, 155, 155)");

var wordsUsedByLang2 = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("x", mostUsedX)
  .attr("y", mostUsedY + 70)
  .attr("text-anchor", "middle");

countriesX = widthInfo / 2;
countriesY = 400;
infoContainer
  .append("text")
  .attr("class", "mostUsedWordHeadline")
  .attr("x", countriesX)
  .attr("y", countriesY)
  .attr("text-anchor", "middle")
  .text("Countries speaking this language:");

var countries = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("x", countriesX)
  .attr("y", countriesY + 40)
  .attr("text-anchor", "middle");

infoContainer
  .append("line")
  .attr("x1", widthInfo / 7 + 2)
  .attr("x2", widthInfo - 52)
  .attr("y1", countriesY + 6)
  .attr("y2", countriesY + 6)
  .attr("stroke-width", "0.04em")
  .attr("stroke", "rgb(155, 155, 155)");

var countries2 = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("x", countriesX)
  .attr("y", countriesY + 70)
  .attr("text-anchor", "middle");

familyX = widthInfo / 2;
familyY = 520;
infoContainer
  .append("text")
  .attr("class", "mostUsedWordHeadline")
  .attr("x", familyX)
  .attr("y", familyY)
  .attr("text-anchor", "middle")
  .text("This language is part of the family:");

var families = infoContainer
  .append("text")
  .attr("class", "smallInfoText")
  .attr("x", familyX)
  .attr("y", familyY + 40)
  .attr("text-anchor", "middle");

infoContainer
  .append("line")
  .attr("x1", widthInfo / 7 + 2)
  .attr("x2", widthInfo - 52)
  .attr("y1", familyY + 6)
  .attr("y2", familyY + 6)
  .attr("stroke-width", "0.04em")
  .attr("stroke", "rgb(155, 155, 155)");

/** Initializing Map Frame */

var linesGroup = svgContainer.append("g");

var lines = linesGroup
  .selectAll("lines")
  .data(linesArr)
  .enter()
  .append("line");

lines
  .attr("x1", 30)
  .attr("x2", widthMap - 50)
  .attr("y1", o => o)
  .attr("y2", o => o)
  .attr("stroke-width", 0.9)
  .attr("stroke-dasharray", "3 8")
  .attr("stroke", "rgba(61, 148, 150, 0.9)");

var circlesGroup = svgContainer
  .append("g")
  .selectAll("g")
  .data(data);

var circlesGroupEnter = circlesGroup
  .enter()
  .append("g")
  .attr("id", function(d, i) {
    return "circle" + i;
  })
  .style("transform-origin", d => `${xScale(d.x)}px ${yScale(d.y)}px`)
  .on("mouseover", mouseOn)
  .on("mouseout", mouseOff);

var circle1Group = circlesGroupEnter.append("circle");
var circle2Group = circlesGroupEnter.append("circle");
circlesGroupEnter.append("svg:image");

var tip = d3
  .tip()
  .attr("class", "tipDesign")
  .offset([-6, 0])
  .html(function(d) {
    return d.language.replace("_", " ").replace("_", " ");
  });

/** Functions Implementation */

function updateWindowSize() {
  widthMap = 1400 - marginMap.right - marginMap.left;
  heightMap = 900 - marginMap.top - marginMap.bottom;
  widthInfo = 330;
  xScale.range([50, widthMap - 50]);
  yScale.range([50, heightMap - 50]);
}

function render() {
  updateWindowSize();
  svgContainer.call(tip);

  circlesGroupEnter
    .attr("class", o => {
      if (cur_view == "flag") return "circleDesign flag";
      else if (cur_view == "geo") return "circleDesign geo geo" + o.geo;
      else if (cur_view == "family")
        return "circleDesign family family" + o.family;
      else if (cur_view == "happiness") return "circleDesign happiness";
    })
    .classed("hidden", hidePoints);

  circle1Group
    .attr("id", "geoFamily")
    .attr("cx", o => xScale(o.x))
    .attr("cy", o => yScale(o.y))
    .attr("r", "1.3em");

  circle2Group
    .attr("id", "happy")
    .attr("cx", o => xScale(o.x))
    .attr("cy", o => yScale(o.y))
    .attr("r", "1.3em")

    .attr("fill", function(d) {
      if (d.happiness == 15) return "transparent";
      else if (d.happiness > 15 && d.happiness < 16.8) return "#9A2A1B";
      else if (d.happiness >= 16.8 && d.happiness < 20.7) return "#9A2A1B";
      else if (d.happiness >= 20.7 && d.happiness < 24.7) return "#A62F30";
      else if (d.happiness >= 24.7 && d.happiness < 28.6) return "#FAC933";
      else if (d.happiness >= 28.6 && d.happiness < 30) return "#FCEB33";
      else if (d.happiness >= 30 && d.happiness < 32.6) return "#BAD15E";
      else if (d.happiness >= 32.6 && d.happiness < 36.6) return "#4DA86B";
      else if (d.happiness >= 36.6 && d.happiness < 40.6) return "#2E6603";
      else if (d.happiness >= 40.6 && d.happiness < 44.5) return "#2E6603";
      else if (d.happiness >= 44.5) return "#4DA86B";
    });

  circlesGroupEnter
    .select("image")
    .attr("xlink:href", o => "resources/flags/" + o.language + ".png")
    .attr("text-anchor", "middle")
    .attr("x", o => xScale(o.x) - 22)
    .attr("y", o => yScale(o.y) - 22)
    .attr("width", "2.7em")
    .attr("name", o => o.language)
    .on("click", function(o) {
      index = data.findIndex(function(element) {
        return element.language == o.language;
      });
      cur_lang = index;
      renderInfo();
    });
}

function renderInfo() {
  cur_headline = data[cur_lang].language;
  if (
    cur_headline == "Spanish_Spain" ||
    cur_headline == "Spanish_South_America"
  )
    cur_headline = "Spanish";
  else if (
    cur_headline == "Portuguese_Brazil" ||
    cur_headline == "Portuguese_Europe"
  )
    cur_headline = "Portuguese";
  infoHeadline.text(cur_headline);
  infoLanguageName.text(capitalizeFirstLetter(data[cur_lang].lang_written));
  // infoHeadline.text(capitalizeFirstLetter(data[cur_lang].lang_written));
  // infoLanguageName.text(cur_headline);
  mostUsedWords.text(
    capitalizeFirstLetter(data[cur_lang].unique_word_per_lang)
  );
  numSpeakers.text(numberWithCommas(data[cur_lang].speakers));
  unique_lang_per_word = data[cur_lang].unique_lang_per_word;

  if (unique_lang_per_word == "") {
    wordsUsedByLang.text("- - - - - - -");
    wordsUsedByLang2.text("");
  } else if (unique_lang_per_word.split("|").length > 3) {
    var arr = unique_lang_per_word.split("|");
    wordsUsedByLang.text(arr.slice(0, 3).join("|"));
    wordsUsedByLang2.text(arr.slice(3).join("|"));
  } else {
    wordsUsedByLang.text(unique_lang_per_word);
    wordsUsedByLang2.text("");
  }

  countries_str = data[cur_lang].countries;
  var arr = countries_str.split("|");
  if (arr[arr.length - 1].startsWith(" more")) {
    countries.text(arr.slice(0, -1).join("|"));
    countries2.text(arr.slice(-1).join("|"));
  } else if (countries_str.split("|").length > 3) {
    countries.text(arr.slice(0, 3).join("|"));
    countries2.text(arr.slice(3).join("|"));
  } else {
    countries.text(countries_str);
    countries2.text("");
  }
  family_str = data[cur_lang].family_name;
  family_str = family_str.replace(",", " >>");
  families.text(family_str);
}

function renderLoad() {
  render();
  renderInfo();
}

function openMap() {
  document.getElementById("overlayDiv").classList.add("hidden");
  hidePoints = false;

  for (var i = 0; i < data.length; i++) {
    setTimeout(_ => {
      document.getElementById("circle" + index).classList.remove("hidden");
      index += 1;
    }, 450 + i * 37);
  }
  if (index == 53) render();
}

function mouseOn(d) {
  tip.show(d);
}

function mouseOff(d) {
  tip.hide(d);
}

function onButton(view) {
  icon = get_icon_name(cur_view);
  document.getElementById(cur_view + "Icon").className =
    "fa fa-" + icon + " fa-gradient";
  document.getElementById(cur_view + "Icon").classList.add("fa-gradient");

  cur_view = view;
  icon = get_icon_name(view);

  document.getElementById(view + "Button").className = "buttonDesign active";
  document.getElementById(view + "Icon").className =
    "fa fa-" + icon + " fa-gradient active";

  if (view != "flag") {
    document.getElementById("flagButton").className = "buttonDesign";
  }
  if (view != "geo") {
    document.getElementById("geoButton").className = "buttonDesign";
  }
  if (view != "family") {
    document.getElementById("familyButton").className = "buttonDesign";
  }
  if (view != "happiness") {
    document.getElementById("happinessButton").className = "buttonDesign";
  }
  render();
}

function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

const numberWithCommas = x => {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
};

function get_icon_name(view) {
  icon = "";
  if (view == "flag") icon = "flag";
  else if (view == "geo") icon = "globe";
  else if (view == "family") icon = "tree";
  else if (view == "happiness") icon = "thumbs-up";
  return icon;
}

function remove_hidden() {
  document.getElementById("circle" + index).classList.remove("hidden");
  index += 1;
}

function updateWindowSize() {
  widthMap = 1400 - marginMap.right - marginMap.left;
  heightMap = 900 - marginMap.top - marginMap.bottom;
  widthInfo = 330;
  xScale.range([50, widthMap - 50]);
  yScale.range([50, heightMap - 50]);
}
